{% extends 'base.html' %} {% block content %}



<div class="col-lg-12 performance-message">
    <div class="jumbotron">
        <h1>Performance</h1>
        <p>Below you can see how well the base game and features are doing. With details on:</p>

        <ul>- Base game status</ul>
        <ul>- Most popular bugs and features</ul>
        <ul>- Current bugs</ul>
        <ul>- Fixed bugs</ul>
        <ul> -New features</ul>







    </div>
</div>


<div class="col-lg-12 performance-panel1">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <h1 class="performance-title-styling">Top 5 features by user likes</h1>
            <table class="table table-styling">

                <thead>
                    <tr>
                        <th scope="col" style="text-align: center; color: #ffff52e3;">#</th>
                        <th scope="col" style="text-align: center; color: #ffff52e3;">Feature</th>
                        <th scope="col" style="text-align: center; color: #ffff52e3;">Likes</th>

                    </tr>
                </thead>

                {% for feature in top_features %}
                <tbody>
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td><a href="{% url 'feature_info' feature.id  %}">{{ feature }}</a></td>
                        <td>{{feature.likes}}</td>
                    </tr>
                </tbody>
                {% endfor %}
            </table>
        </div>

        <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 col-xl-6">
            <h1 class="performance-title-styling">Top 5 Bugs by user upvotes</h1>
            <table class="table table-styling">

                <thead>
                    <tr>
                        <th scope="col" style="text-align: center; color: #ffff52e3;">#</th>
                        <th scope="col" style="text-align: center; color: #ffff52e3;">Bug</th>
                        <th scope="col" style="text-align: center; color: #ffff52e3;">Likes</th>

                    </tr>
                </thead>

                {% for bug in top_bugs %}
                <tbody>
                    <tr>
                        <td>{{forloop.counter}}</td>
                        <td><a href="{% url 'bug_info' bug.id  %}">{{ bug }}</a></td>
                        <td>{{bug.upvotes}}</td>
                    </tr>
                </tbody>
                {% endfor %}
            </table>
        </div>
    </div>
</div>

<div class="col-lg-12 performance-panel2">




    <div class="row">
        <h1 class="performance-title-styling">Bugs</h1>


        <div class="col-md-9 col-md-offset-1 col-lg-5 col-lg-offset-1 col-xl-5 col-xl-offset-1">
            <h3 class="performance-title-styling">New bugs added in the past week</h3>
            <canvas class="performace-well" id="bug_per_week" width="500" height="500"></canvas>
        </div>



        <div class="col-md-9 col-md-offset-1 col-lg-5 col-lg-offset-0 col-xl-5 col-xl-offset-0">
            <h3 class="performance-title-styling">Current bug stauses</h3>
            <canvas class="performace-well" id="status_of_bugs_chart" width="500" height="500"></canvas>
        </div>

    </div>
</div>



<div class="col-lg-12 performance-panel3">

    <div class="row">
        <h1 class="performance-title-styling">Features</h1>


        <div class="col-md-9 col-md-offset-1 col-lg-5 col-lg-offset-1 col-xl-5 col-xl-offset-1">
            <h3 class="performance-title-styling">Current feature types</h3>
            <canvas class="performace-well" id="current_feature_types" width="500" height="500"></canvas>
        </div>



        <div class="col-md-9 col-md-offset-1 col-lg-5 col-lg-offset-0 col-xl-5 col-xl-offset-0">
            <h3 class="performance-title-styling">How many bugs each available feature type have</h3>
            <canvas class="performace-well" id="bugs_per_feature" width="500" height="500"></canvas>
        </div>

    </div>




</div>

<div class="col-lg-12 performance-panel4">



</div>

<div class="col-lg-12 performance-panel5">

</div>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
<script>
    var endpoint = "{% url 'graph_data' %}"
    var labels = []
    Chart.defaults.global.defaultFontColor = '#f5f5f5';
    $.ajax({
        method: "GET",
        url: endpoint,
        success: function(data) {
            labels1 = data.labels1
            labels2 = data.labels2
            labels3 = data.labels3
            labels4 = data.labels4
            data_for_bugs_week = data.data_for_bugs_week
            bugs_status = data.bugs_status
            amount_of_features_per_types = data.amount_of_features_per_types
            amount_of_bugs_per_feature_type = data.amount_of_bugs_per_feature_type
            bug_per_week_chart()
            status_of_bugs_chart()
            current_feature_types()
            bugs_per_feature()


        },
        error: function(error_data) {
            console.log(error_data)
        }
    })
    


    function bug_per_week_chart() {
        var ctx = document.getElementById("bug_per_week").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels1,
                datasets: [{
                    label: 'New bugs added today',
                    data: data_for_bugs_week,
                    backgroundColor: [
                        'transparent',



                    ],
                    borderColor: '#EA2B1F',
                    borderWidth: 1,
                    pointBackgroundColor: '#EA2B1F',
                    pointRadius: 5,
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                            stepSize: 1,

                        }
                    }]
                }
            }
        });
    }


    function status_of_bugs_chart() {
        var ctx = document.getElementById("status_of_bugs_chart").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels2,
                datasets: [

                    {
                        label: 'Bug stauses',
                        data: bugs_status,
                        backgroundColor: [
                            '#EA2B1F',
                            '#F19A3E',
                            '#8CB369',


                        ],

                        borderWidth: 1
                    },
                ]


            },
            options: {
                scales: {
                    yAxes: [{

                        ticks: {
                            beginAtZero: true,
                            stepSize: 1,
                        }
                    }]
                }
            }
        });
    }

    /*-------------Features charts--------------------*/
    
    function current_feature_types() {
        var ctx = document.getElementById("current_feature_types").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: labels3,
                datasets: [

                    {
                        label: 'feature types',
                        data: amount_of_features_per_types,
                        backgroundColor: [
                            '#EA2B1F',
                            '#F19A3E',
                            '#8CB369',
                            'purple',


                        ],

                        borderWidth: 1
                    },
                ]


            },
            options: {
                scales: {
                    
                }
            }
        });
    }

    function bugs_per_feature() {
        var ctx = document.getElementById("bugs_per_feature").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'polarArea',
            data: {
                labels: labels4,
                datasets: [

                    {
                        label: 'Bug stauses',
                        data: amount_of_bugs_per_feature_type,
                        backgroundColor: [
                            '#EA2B1F',
                            '#F19A3E',
                            '#8CB369',
                            'purple',
                            'silver',


                        ],

                        borderWidth: 1
                    },
                ]


            },
            options: {
                tooltips: {
                    callbacks: {
                         label: function(tooltipItem, data) {
                             return "There are " + Number(tooltipItem.yLabel) + " Bugs in: " + data.labels[tooltipItem.index];
                                }
                            }
                        },
                scales: {
                   
                }
            }
        });
    }
</script>

{% endblock %}
